{"ast":null,"code":"import _toConsumableArray from\"D:\\\\online projects\\\\mern-amazona\\\\frontend\\\\node_modules\\\\@babel\\\\runtime\\\\helpers\\\\esm\\\\toConsumableArray.js\";import _asyncToGenerator from\"D:\\\\online projects\\\\mern-amazona\\\\frontend\\\\node_modules\\\\@babel\\\\runtime\\\\helpers\\\\esm\\\\asyncToGenerator.js\";import _slicedToArray from\"D:\\\\online projects\\\\mern-amazona\\\\frontend\\\\node_modules\\\\@babel\\\\runtime\\\\helpers\\\\esm\\\\slicedToArray.js\";import _objectSpread from\"D:\\\\online projects\\\\mern-amazona\\\\frontend\\\\node_modules\\\\@babel\\\\runtime\\\\helpers\\\\esm\\\\objectSpread2.js\";import _regeneratorRuntime from\"D:\\\\online projects\\\\mern-amazona\\\\frontend\\\\node_modules\\\\@babel\\\\runtime\\\\regenerator\\\\index.js\";import axios from'axios';import{useContext,useEffect,useReducer,useRef,useState}from'react';import{Link,useNavigate,useParams}from'react-router-dom';import Row from'react-bootstrap/Row';import Col from'react-bootstrap/Col';import Card from'react-bootstrap/Card';import ListGroup from'react-bootstrap/ListGroup';import Form from'react-bootstrap/Form';import Badge from'react-bootstrap/Badge';import Button from'react-bootstrap/Button';import Rating from'../components/Rating';import{Helmet}from'react-helmet-async';import LoadingBox from'../components/LoadingBox';import MessageBox from'../components/MessageBox';import{getError}from'../utils';import{Store}from'../Store';import FloatingLabel from'react-bootstrap/FloatingLabel';import{toast}from'react-toastify';import{jsx as _jsx}from\"react/jsx-runtime\";import{jsxs as _jsxs}from\"react/jsx-runtime\";var reducer=function reducer(state,action){switch(action.type){case'REFRESH_PRODUCT':return _objectSpread(_objectSpread({},state),{},{product:action.payload});case'CREATE_REQUEST':return _objectSpread(_objectSpread({},state),{},{loadingCreateReview:true});case'CREATE_SUCCESS':return _objectSpread(_objectSpread({},state),{},{loadingCreateReview:false});case'CREATE_FAIL':return _objectSpread(_objectSpread({},state),{},{loadingCreateReview:false});case'FETCH_REQUEST':return _objectSpread(_objectSpread({},state),{},{loading:true});case'FETCH_SUCCESS':return _objectSpread(_objectSpread({},state),{},{product:action.payload,loading:false});case'FETCH_FAIL':return _objectSpread(_objectSpread({},state),{},{loading:false,error:action.payload});default:return state;}};function ProductScreen(){var reviewsRef=useRef();var _useState=useState(0),_useState2=_slicedToArray(_useState,2),rating=_useState2[0],setRating=_useState2[1];var _useState3=useState(''),_useState4=_slicedToArray(_useState3,2),comment=_useState4[0],setComment=_useState4[1];var _useState5=useState(''),_useState6=_slicedToArray(_useState5,2),selectedImage=_useState6[0],setSelectedImage=_useState6[1];var navigate=useNavigate();var params=useParams();var slug=params.slug;var _useReducer=useReducer(reducer,{product:[],loading:true,error:''}),_useReducer2=_slicedToArray(_useReducer,2),_useReducer2$=_useReducer2[0],loading=_useReducer2$.loading,error=_useReducer2$.error,product=_useReducer2$.product,loadingCreateReview=_useReducer2$.loadingCreateReview,dispatch=_useReducer2[1];useEffect(function(){var fetchData=/*#__PURE__*/function(){var _ref=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee(){var result;return _regeneratorRuntime.wrap(function _callee$(_context){while(1){switch(_context.prev=_context.next){case 0:dispatch({type:'FETCH_REQUEST'});_context.prev=1;_context.next=4;return axios.get(\"/api/products/slug/\".concat(slug));case 4:result=_context.sent;dispatch({type:'FETCH_SUCCESS',payload:result.data});_context.next=11;break;case 8:_context.prev=8;_context.t0=_context[\"catch\"](1);dispatch({type:'FETCH_FAIL',payload:getError(_context.t0)});case 11:case\"end\":return _context.stop();}}},_callee,null,[[1,8]]);}));return function fetchData(){return _ref.apply(this,arguments);};}();fetchData();},[slug]);var _useContext=useContext(Store),state=_useContext.state,ctxDispatch=_useContext.dispatch;var cart=state.cart,userInfo=state.userInfo;var addToCartHandler=/*#__PURE__*/function(){var _ref2=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee2(){var existItem,quantity,_yield$axios$get,data;return _regeneratorRuntime.wrap(function _callee2$(_context2){while(1){switch(_context2.prev=_context2.next){case 0:existItem=cart.cartItems.find(function(x){return x._id===product._id;});quantity=existItem?existItem.quantity+1:1;_context2.next=4;return axios.get(\"/api/products/\".concat(product._id));case 4:_yield$axios$get=_context2.sent;data=_yield$axios$get.data;if(!(data.countInStock<quantity)){_context2.next=9;break;}window.alert('Sorry. Product is out of stock');return _context2.abrupt(\"return\");case 9:ctxDispatch({type:'CART_ADD_ITEM',payload:_objectSpread(_objectSpread({},product),{},{quantity:quantity})});navigate('/cart');case 11:case\"end\":return _context2.stop();}}},_callee2);}));return function addToCartHandler(){return _ref2.apply(this,arguments);};}();var submitHandler=/*#__PURE__*/function(){var _ref3=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee3(e){var _yield$axios$post,data;return _regeneratorRuntime.wrap(function _callee3$(_context3){while(1){switch(_context3.prev=_context3.next){case 0:e.preventDefault();if(!(!comment||!rating)){_context3.next=4;break;}toast.error('Please enter comment and rating');return _context3.abrupt(\"return\");case 4:_context3.prev=4;_context3.next=7;return axios.post(\"/api/products/\".concat(product._id,\"/reviews\"),{rating:rating,comment:comment,name:userInfo.name},{headers:{Authorization:\"Bearer \".concat(userInfo.token)}});case 7:_yield$axios$post=_context3.sent;data=_yield$axios$post.data;dispatch({type:'CREATE_SUCCESS'});toast.success('Review submitted successfully');product.reviews.unshift(data.review);product.numReviews=data.numReviews;product.rating=data.rating;dispatch({type:'REFRESH_PRODUCT',payload:product});window.scrollTo({behavior:'smooth',top:reviewsRef.current.offsetTop});_context3.next=22;break;case 18:_context3.prev=18;_context3.t0=_context3[\"catch\"](4);toast.error(getError(_context3.t0));dispatch({type:'CREATE_FAIL'});case 22:case\"end\":return _context3.stop();}}},_callee3,null,[[4,18]]);}));return function submitHandler(_x){return _ref3.apply(this,arguments);};}();return loading?/*#__PURE__*/_jsx(LoadingBox,{}):error?/*#__PURE__*/_jsx(MessageBox,{variant:\"danger\",children:error}):/*#__PURE__*/_jsxs(\"div\",{children:[/*#__PURE__*/_jsxs(Row,{children:[/*#__PURE__*/_jsx(Col,{md:6,children:/*#__PURE__*/_jsx(\"img\",{className:\"img-large\",src:selectedImage||product.image,alt:product.name})}),/*#__PURE__*/_jsx(Col,{md:3,children:/*#__PURE__*/_jsxs(ListGroup,{variant:\"flush\",children:[/*#__PURE__*/_jsxs(ListGroup.Item,{children:[/*#__PURE__*/_jsx(Helmet,{children:/*#__PURE__*/_jsx(\"title\",{children:product.name})}),/*#__PURE__*/_jsx(\"h1\",{children:product.name})]}),/*#__PURE__*/_jsx(ListGroup.Item,{children:/*#__PURE__*/_jsx(Rating,{rating:product.rating,numReviews:product.numReviews})}),/*#__PURE__*/_jsxs(ListGroup.Item,{children:[\"Pirce : $\",product.price]}),/*#__PURE__*/_jsx(ListGroup.Item,{children:/*#__PURE__*/_jsx(Row,{xs:1,md:2,className:\"g-2\",children:[product.image].concat(_toConsumableArray(product.images)).map(function(x){return/*#__PURE__*/_jsx(Col,{children:/*#__PURE__*/_jsx(Card,{children:/*#__PURE__*/_jsx(Button,{className:\"thumbnail\",type:\"button\",variant:\"light\",onClick:function onClick(){return setSelectedImage(x);},children:/*#__PURE__*/_jsx(Card.Img,{variant:\"top\",src:x,alt:\"product\"})})})},x);})})}),/*#__PURE__*/_jsxs(ListGroup.Item,{children:[\"Description:\",/*#__PURE__*/_jsx(\"p\",{children:product.description})]})]})}),/*#__PURE__*/_jsx(Col,{md:3,children:/*#__PURE__*/_jsx(Card,{children:/*#__PURE__*/_jsx(Card.Body,{children:/*#__PURE__*/_jsxs(ListGroup,{variant:\"flush\",children:[/*#__PURE__*/_jsx(ListGroup.Item,{children:/*#__PURE__*/_jsxs(Row,{children:[/*#__PURE__*/_jsx(Col,{children:\"Price:\"}),/*#__PURE__*/_jsxs(Col,{children:[\"$\",product.price]})]})}),/*#__PURE__*/_jsx(ListGroup.Item,{children:/*#__PURE__*/_jsxs(Row,{children:[/*#__PURE__*/_jsx(Col,{children:\"Status:\"}),/*#__PURE__*/_jsx(Col,{children:product.countInStock>0?/*#__PURE__*/_jsx(Badge,{bg:\"success\",children:\"In Stock\"}):/*#__PURE__*/_jsx(Badge,{bg:\"danger\",children:\"Unavailable\"})})]})}),product.countInStock>0&&/*#__PURE__*/_jsx(ListGroup.Item,{children:/*#__PURE__*/_jsx(\"div\",{className:\"d-grid\",children:/*#__PURE__*/_jsx(Button,{onClick:addToCartHandler,variant:\"primary\",children:\"Add to Cart\"})})})]})})})})]}),/*#__PURE__*/_jsxs(\"div\",{className:\"my-3\",children:[/*#__PURE__*/_jsx(\"h2\",{ref:reviewsRef,children:\"Reviews\"}),/*#__PURE__*/_jsx(\"div\",{className:\"mb-3\",children:product.reviews.length===0&&/*#__PURE__*/_jsx(MessageBox,{children:\"There is no review\"})}),/*#__PURE__*/_jsx(ListGroup,{children:product.reviews.map(function(review){return/*#__PURE__*/_jsxs(ListGroup.Item,{children:[/*#__PURE__*/_jsx(\"strong\",{children:review.name}),/*#__PURE__*/_jsx(Rating,{rating:review.rating,caption:\" \"}),/*#__PURE__*/_jsx(\"p\",{children:review.createdAt.substring(0,10)}),/*#__PURE__*/_jsx(\"p\",{children:review.comment})]},review._id);})}),/*#__PURE__*/_jsx(\"div\",{className:\"my-3\",children:userInfo?/*#__PURE__*/_jsxs(\"form\",{onSubmit:submitHandler,children:[/*#__PURE__*/_jsx(\"h2\",{children:\"Write a customer review\"}),/*#__PURE__*/_jsxs(Form.Group,{className:\"mb-3\",controlId:\"rating\",children:[/*#__PURE__*/_jsx(Form.Label,{children:\"Rating\"}),/*#__PURE__*/_jsxs(Form.Select,{\"aria-label\":\"Rating\",value:rating,onChange:function onChange(e){return setRating(e.target.value);},children:[/*#__PURE__*/_jsx(\"option\",{value:\"\",children:\"Select...\"}),/*#__PURE__*/_jsx(\"option\",{value:\"1\",children:\"1- Poor\"}),/*#__PURE__*/_jsx(\"option\",{value:\"2\",children:\"2- Fair\"}),/*#__PURE__*/_jsx(\"option\",{value:\"3\",children:\"3- Good\"}),/*#__PURE__*/_jsx(\"option\",{value:\"4\",children:\"4- Very good\"}),/*#__PURE__*/_jsx(\"option\",{value:\"5\",children:\"5- Excelent\"})]})]}),/*#__PURE__*/_jsx(FloatingLabel,{controlId:\"floatingTextarea\",label:\"Comments\",className:\"mb-3\",children:/*#__PURE__*/_jsx(Form.Control,{as:\"textarea\",placeholder:\"Leave a comment here\",value:comment,onChange:function onChange(e){return setComment(e.target.value);}})}),/*#__PURE__*/_jsxs(\"div\",{className:\"mb-3\",children:[/*#__PURE__*/_jsx(Button,{disabled:loadingCreateReview,type:\"submit\",children:\"Submit\"}),loadingCreateReview&&/*#__PURE__*/_jsx(LoadingBox,{})]})]}):/*#__PURE__*/_jsxs(MessageBox,{children:[\"Please\",' ',/*#__PURE__*/_jsx(Link,{to:\"/signin?redirect=/product/\".concat(product.slug),children:\"Sign In\"}),' ',\"to write a review\"]})})]})]});}export default ProductScreen;","map":{"version":3,"sources":["D:/online projects/mern-amazona/frontend/src/screens/ProductScreen.js"],"names":["axios","useContext","useEffect","useReducer","useRef","useState","Link","useNavigate","useParams","Row","Col","Card","ListGroup","Form","Badge","Button","Rating","Helmet","LoadingBox","MessageBox","getError","Store","FloatingLabel","toast","reducer","state","action","type","product","payload","loadingCreateReview","loading","error","ProductScreen","reviewsRef","rating","setRating","comment","setComment","selectedImage","setSelectedImage","navigate","params","slug","dispatch","fetchData","get","result","data","ctxDispatch","cart","userInfo","addToCartHandler","existItem","cartItems","find","x","_id","quantity","countInStock","window","alert","submitHandler","e","preventDefault","post","name","headers","Authorization","token","success","reviews","unshift","review","numReviews","scrollTo","behavior","top","current","offsetTop","image","price","images","map","description","length","createdAt","substring","target","value"],"mappings":"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","sourcesContent":["import axios from 'axios';\r\nimport { useContext, useEffect, useReducer, useRef, useState } from 'react';\r\nimport { Link, useNavigate, useParams } from 'react-router-dom';\r\nimport Row from 'react-bootstrap/Row';\r\nimport Col from 'react-bootstrap/Col';\r\nimport Card from 'react-bootstrap/Card';\r\nimport ListGroup from 'react-bootstrap/ListGroup';\r\nimport Form from 'react-bootstrap/Form';\r\nimport Badge from 'react-bootstrap/Badge';\r\nimport Button from 'react-bootstrap/Button';\r\nimport Rating from '../components/Rating';\r\nimport { Helmet } from 'react-helmet-async';\r\nimport LoadingBox from '../components/LoadingBox';\r\nimport MessageBox from '../components/MessageBox';\r\nimport { getError } from '../utils';\r\nimport { Store } from '../Store';\r\nimport FloatingLabel from 'react-bootstrap/FloatingLabel';\r\nimport { toast } from 'react-toastify';\r\n\r\nconst reducer = (state, action) => {\r\n  switch (action.type) {\r\n    case 'REFRESH_PRODUCT':\r\n      return { ...state, product: action.payload };\r\n    case 'CREATE_REQUEST':\r\n      return { ...state, loadingCreateReview: true };\r\n    case 'CREATE_SUCCESS':\r\n      return { ...state, loadingCreateReview: false };\r\n    case 'CREATE_FAIL':\r\n      return { ...state, loadingCreateReview: false };\r\n    case 'FETCH_REQUEST':\r\n      return { ...state, loading: true };\r\n    case 'FETCH_SUCCESS':\r\n      return { ...state, product: action.payload, loading: false };\r\n    case 'FETCH_FAIL':\r\n      return { ...state, loading: false, error: action.payload };\r\n    default:\r\n      return state;\r\n  }\r\n};\r\n\r\nfunction ProductScreen() {\r\n  let reviewsRef = useRef();\r\n\r\n  const [rating, setRating] = useState(0);\r\n  const [comment, setComment] = useState('');\r\n  const [selectedImage, setSelectedImage] = useState('');\r\n\r\n  const navigate = useNavigate();\r\n  const params = useParams();\r\n  const { slug } = params;\r\n\r\n  const [{ loading, error, product, loadingCreateReview }, dispatch] =\r\n    useReducer(reducer, {\r\n      product: [],\r\n      loading: true,\r\n      error: '',\r\n    });\r\n  useEffect(() => {\r\n    const fetchData = async () => {\r\n      dispatch({ type: 'FETCH_REQUEST' });\r\n      try {\r\n        const result = await axios.get(`/api/products/slug/${slug}`);\r\n        dispatch({ type: 'FETCH_SUCCESS', payload: result.data });\r\n      } catch (err) {\r\n        dispatch({ type: 'FETCH_FAIL', payload: getError(err) });\r\n      }\r\n    };\r\n    fetchData();\r\n  }, [slug]);\r\n\r\n  const { state, dispatch: ctxDispatch } = useContext(Store);\r\n  const { cart, userInfo } = state;\r\n  const addToCartHandler = async () => {\r\n    const existItem = cart.cartItems.find((x) => x._id === product._id);\r\n    const quantity = existItem ? existItem.quantity + 1 : 1;\r\n    const { data } = await axios.get(`/api/products/${product._id}`);\r\n    if (data.countInStock < quantity) {\r\n      window.alert('Sorry. Product is out of stock');\r\n      return;\r\n    }\r\n    ctxDispatch({\r\n      type: 'CART_ADD_ITEM',\r\n      payload: { ...product, quantity },\r\n    });\r\n    navigate('/cart');\r\n  };\r\n\r\n  const submitHandler = async (e) => {\r\n    e.preventDefault();\r\n    if (!comment || !rating) {\r\n      toast.error('Please enter comment and rating');\r\n      return;\r\n    }\r\n    try {\r\n      const { data } = await axios.post(\r\n        `/api/products/${product._id}/reviews`,\r\n        { rating, comment, name: userInfo.name },\r\n        {\r\n          headers: { Authorization: `Bearer ${userInfo.token}` },\r\n        }\r\n      );\r\n\r\n      dispatch({\r\n        type: 'CREATE_SUCCESS',\r\n      });\r\n      toast.success('Review submitted successfully');\r\n      product.reviews.unshift(data.review);\r\n      product.numReviews = data.numReviews;\r\n      product.rating = data.rating;\r\n      dispatch({ type: 'REFRESH_PRODUCT', payload: product });\r\n      window.scrollTo({\r\n        behavior: 'smooth',\r\n        top: reviewsRef.current.offsetTop,\r\n      });\r\n    } catch (error) {\r\n      toast.error(getError(error));\r\n      dispatch({ type: 'CREATE_FAIL' });\r\n    }\r\n  };\r\n  return loading ? (\r\n    <LoadingBox />\r\n  ) : error ? (\r\n    <MessageBox variant=\"danger\">{error}</MessageBox>\r\n  ) : (\r\n    <div>\r\n      <Row>\r\n        <Col md={6}>\r\n          <img\r\n            className=\"img-large\"\r\n            src={selectedImage || product.image}\r\n            alt={product.name}\r\n          ></img>\r\n        </Col>\r\n        <Col md={3}>\r\n          <ListGroup variant=\"flush\">\r\n            <ListGroup.Item>\r\n              <Helmet>\r\n                <title>{product.name}</title>\r\n              </Helmet>\r\n              <h1>{product.name}</h1>\r\n            </ListGroup.Item>\r\n            <ListGroup.Item>\r\n              <Rating\r\n                rating={product.rating}\r\n                numReviews={product.numReviews}\r\n              ></Rating>\r\n            </ListGroup.Item>\r\n            <ListGroup.Item>Pirce : ${product.price}</ListGroup.Item>\r\n            <ListGroup.Item>\r\n              <Row xs={1} md={2} className=\"g-2\">\r\n                {[product.image, ...product.images].map((x) => (\r\n                  <Col key={x}>\r\n                    <Card>\r\n                      <Button\r\n                        className=\"thumbnail\"\r\n                        type=\"button\"\r\n                        variant=\"light\"\r\n                        onClick={() => setSelectedImage(x)}\r\n                      >\r\n                        <Card.Img variant=\"top\" src={x} alt=\"product\" />\r\n                      </Button>\r\n                    </Card>\r\n                  </Col>\r\n                ))}\r\n              </Row>\r\n            </ListGroup.Item>\r\n            <ListGroup.Item>\r\n              Description:\r\n              <p>{product.description}</p>\r\n            </ListGroup.Item>\r\n          </ListGroup>\r\n        </Col>\r\n        <Col md={3}>\r\n          <Card>\r\n            <Card.Body>\r\n              <ListGroup variant=\"flush\">\r\n                <ListGroup.Item>\r\n                  <Row>\r\n                    <Col>Price:</Col>\r\n                    <Col>${product.price}</Col>\r\n                  </Row>\r\n                </ListGroup.Item>\r\n                <ListGroup.Item>\r\n                  <Row>\r\n                    <Col>Status:</Col>\r\n                    <Col>\r\n                      {product.countInStock > 0 ? (\r\n                        <Badge bg=\"success\">In Stock</Badge>\r\n                      ) : (\r\n                        <Badge bg=\"danger\">Unavailable</Badge>\r\n                      )}\r\n                    </Col>\r\n                  </Row>\r\n                </ListGroup.Item>\r\n\r\n                {product.countInStock > 0 && (\r\n                  <ListGroup.Item>\r\n                    <div className=\"d-grid\">\r\n                      <Button onClick={addToCartHandler} variant=\"primary\">\r\n                        Add to Cart\r\n                      </Button>\r\n                    </div>\r\n                  </ListGroup.Item>\r\n                )}\r\n              </ListGroup>\r\n            </Card.Body>\r\n          </Card>\r\n        </Col>\r\n      </Row>\r\n      <div className=\"my-3\">\r\n        <h2 ref={reviewsRef}>Reviews</h2>\r\n        <div className=\"mb-3\">\r\n          {product.reviews.length === 0 && (\r\n            <MessageBox>There is no review</MessageBox>\r\n          )}\r\n        </div>\r\n        <ListGroup>\r\n          {product.reviews.map((review) => (\r\n            <ListGroup.Item key={review._id}>\r\n              <strong>{review.name}</strong>\r\n              <Rating rating={review.rating} caption=\" \"></Rating>\r\n              <p>{review.createdAt.substring(0, 10)}</p>\r\n              <p>{review.comment}</p>\r\n            </ListGroup.Item>\r\n          ))}\r\n        </ListGroup>\r\n        <div className=\"my-3\">\r\n          {userInfo ? (\r\n            <form onSubmit={submitHandler}>\r\n              <h2>Write a customer review</h2>\r\n              <Form.Group className=\"mb-3\" controlId=\"rating\">\r\n                <Form.Label>Rating</Form.Label>\r\n                <Form.Select\r\n                  aria-label=\"Rating\"\r\n                  value={rating}\r\n                  onChange={(e) => setRating(e.target.value)}\r\n                >\r\n                  <option value=\"\">Select...</option>\r\n                  <option value=\"1\">1- Poor</option>\r\n                  <option value=\"2\">2- Fair</option>\r\n                  <option value=\"3\">3- Good</option>\r\n                  <option value=\"4\">4- Very good</option>\r\n                  <option value=\"5\">5- Excelent</option>\r\n                </Form.Select>\r\n              </Form.Group>\r\n              <FloatingLabel\r\n                controlId=\"floatingTextarea\"\r\n                label=\"Comments\"\r\n                className=\"mb-3\"\r\n              >\r\n                <Form.Control\r\n                  as=\"textarea\"\r\n                  placeholder=\"Leave a comment here\"\r\n                  value={comment}\r\n                  onChange={(e) => setComment(e.target.value)}\r\n                />\r\n              </FloatingLabel>\r\n\r\n              <div className=\"mb-3\">\r\n                <Button disabled={loadingCreateReview} type=\"submit\">\r\n                  Submit\r\n                </Button>\r\n                {loadingCreateReview && <LoadingBox></LoadingBox>}\r\n              </div>\r\n            </form>\r\n          ) : (\r\n            <MessageBox>\r\n              Please{' '}\r\n              <Link to={`/signin?redirect=/product/${product.slug}`}>\r\n                Sign In\r\n              </Link>{' '}\r\n              to write a review\r\n            </MessageBox>\r\n          )}\r\n        </div>\r\n      </div>\r\n    </div>\r\n  );\r\n}\r\nexport default ProductScreen;\r\n"]},"metadata":{},"sourceType":"module"}